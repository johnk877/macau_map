<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shenzhen NNYY Map</title>
    <!-- Google Maps API with Places library -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3JoCG5vOIVPdRmtwNmm9JdkJZUp_P-5Y&libraries=places&callback=initMaps" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            height: calc(100vh - 200px);
            min-height: 700px;
        }

        .map-container {
            flex: 1;
            position: relative;
            touch-action: pan-x pan-y;
        }

        #map, #shenzhenMap {
            height: 100%;
            width: 100%;
            touch-action: pan-x pan-y;
        }

        .custom-zoom-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .zoom-button {
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: background-color 0.2s;
            user-select: none;
        }

        .zoom-button:hover {
            background: #f5f5f5;
        }

        .zoom-button:active {
            background: #e0e0e0;
        }

        .reset-view-button,
        .toggle-cluster-button,
        .my-location-button {
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: background-color 0.2s;
            user-select: none;
            margin-top: 8px;
        }

        .reset-view-button:hover,
        .toggle-cluster-button:hover,
        .my-location-button:hover {
            background: #f5f5f5;
        }

        .reset-view-button:active,
        .toggle-cluster-button:active,
        .my-location-button:active {
            background: #e0e0e0;
        }

        .toggle-cluster-button.active {
            background: #667eea;
            color: white;
        }

        .my-location-button.active {
            background: #FF6B6B;
            color: white;
        }

        .cluster-label {
            position: absolute;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 8px 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 900;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            pointer-events: none;
        }

        .cluster-label-title {
            font-size: 10px;
            color: #666;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .cluster-numbers {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .cluster-number {
            font-weight: bold;
            font-size: 13px;
        }

        .right-pane {
            width: 450px;
            background: #f8f9fa;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: transform 0.3s ease-in-out;
        }

        .pane-section {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .pane-section h2 {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 6px;
        }

        .legend-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
        }

        .legend-list-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            margin-bottom: 4px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-left: 3px solid transparent;
        }

        .legend-list-item:hover {
            background-color: #e9ecef;
        }

        .legend-list-item.active {
            background-color: #e3f2fd;
            border-left-color: #667eea;
        }

        .legend-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.7em;
            color: white;
            flex-shrink: 0;
        }

        .legend-number.hotel {
            background-color: #FF6B6B;
        }

        .legend-number.transport {
            background-color: #4ECDC4;
        }

        .legend-number.attraction {
            background-color: #45B7D1;
        }

        .legend-number.food {
            background-color: #FFA07A;
        }

        .legend-name {
            flex: 1;
            font-size: 0.7em;
            color: #333;
            line-height: 1.2;
        }

        .details-panel {
            padding: 20px;
        }

        .details-panel h3 {
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 6px;
        }

        .details-panel .category {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .details-panel .category.hotel {
            background-color: #FF6B6B;
            color: white;
        }

        .details-panel .category.transport {
            background-color: #4ECDC4;
            color: white;
        }

        .details-panel .category.attraction {
            background-color: #45B7D1;
            color: white;
        }

        .details-panel .category.food {
            background-color: #FFA07A;
            color: white;
        }

        .details-panel .address {
            color: #666;
            margin: 8px 0;
            font-size: 0.8em;
            line-height: 1.5;
        }

        .details-panel .distance {
            color: #667eea;
            margin: 8px 0;
            font-size: 0.8em;
            font-weight: 600;
        }

        .details-panel .description {
            color: #333;
            line-height: 1.6;
            margin-top: 8px;
            font-size: 0.85em;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-style: italic;
        }

        .tabs-container {
            background: white;
            border-bottom: 2px solid #667eea;
            padding: 0 30px;
        }

        .tabs {
            display: flex;
            gap: 0;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            color: #666;
        }

        .tab:hover {
            background: #f5f5f5;
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8f9ff;
        }

        .map-section {
            display: none;
        }

        .map-section.active {
            display: block;
        }

        .print-button {
            position: fixed;
            top: 30px;
            right: 30px;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            z-index: 1000;
            transition: all 0.3s;
        }

        .print-button:hover {
            background: #5568d3;
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
            transform: translateY(-2px);
        }

        .print-only {
            display: none;
        }

        /* Print styles */
        @media print {
            @page {
                size: A4 portrait;
                margin: 15mm;
            }

            body {
                background: white;
                padding: 0;
                margin: 0;
            }

            .container {
                max-width: 100%;
                box-shadow: none;
                border-radius: 0;
            }

            .header {
                background: white;
                color: #333;
                padding: 5mm 0;
                page-break-after: avoid;
            }

            .header h1 {
                color: #667eea;
                font-size: 1.8em;
                margin-bottom: 5px;
            }

            .header p {
                font-size: 0.9em;
                color: #666;
            }

            .print-button,
            .custom-zoom-controls,
            .main-content,
            .tabs-container {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }

            .print-details-page {
                padding: 0;
            }

            .print-details-page h2 {
                color: #667eea;
                font-size: 1.5em;
                margin-bottom: 12px;
                border-bottom: 2px solid #667eea;
                padding-bottom: 8px;
            }

            .print-attraction {
                margin-bottom: 15px;
                page-break-inside: avoid;
            }

            .print-attraction-header {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 6px;
            }

            .print-attraction-number {
                width: 26px;
                height: 26px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 0.85em;
                flex-shrink: 0;
            }

            .print-attraction-number.hotel {
                background-color: #FF6B6B;
            }

            .print-attraction-number.transport {
                background-color: #4ECDC4;
            }

            .print-attraction-number.attraction {
                background-color: #45B7D1;
            }

            .print-attraction-number.food {
                background-color: #FFA07A;
            }

            .print-attraction-title {
                font-size: 1em;
                font-weight: 600;
                color: #333;
            }

            .print-attraction-category {
                display: inline-block;
                padding: 2px 6px;
                border-radius: 3px;
                font-size: 0.65em;
                font-weight: 600;
                text-transform: uppercase;
                margin-left: 8px;
            }

            .print-attraction-category.hotel {
                background-color: #FF6B6B;
                color: white;
            }

            .print-attraction-category.transport {
                background-color: #4ECDC4;
                color: white;
            }

            .print-attraction-category.attraction {
                background-color: #45B7D1;
                color: white;
            }

            .print-attraction-category.food {
                background-color: #FFA07A;
                color: white;
            }

            .print-attraction-info {
                margin-left: 36px;
                font-size: 0.8em;
                line-height: 1.5;
            }

            .print-attraction-distance {
                color: #667eea;
                font-weight: 600;
                margin-bottom: 4px;
            }

            .print-attraction-address {
                color: #666;
                margin-bottom: 4px;
            }

            .print-attraction-description {
                color: #333;
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }

            .right-pane {
                width: 100%;
                max-height: 400px;
            }

            .legend-list {
                grid-template-columns: 1fr;
            }

            #map, #shenzhenMap {
                height: 500px;
            }

            .map-container {
                height: 500px;
                min-height: 500px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
        }

        /* Further Details Overlay Styles */
        .details-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            overflow-y: auto;
            padding: 20px;
        }

        .details-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .details-modal {
            background: white;
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .details-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 16px 16px 0 0;
            position: relative;
        }

        .details-modal-header h2 {
            font-size: 1.8em;
            margin-bottom: 8px;
        }

        .details-modal-header .category-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
            margin-bottom: 12px;
        }

        .details-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .details-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .details-modal-body {
            padding: 30px;
        }

        .details-section {
            margin-bottom: 30px;
        }

        .details-section h3 {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .details-section h3::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #667eea;
            border-radius: 2px;
        }

        .address-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .address-block p {
            margin: 0;
            color: #333;
            line-height: 1.6;
        }

        .hours-list {
            list-style: none;
            padding: 0;
        }

        .hours-list li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hours-list li.today {
            background: #e3f2fd;
            border-left: 4px solid #667eea;
            font-weight: 600;
        }

        .hours-day {
            color: #333;
            font-weight: 500;
        }

        .hours-time {
            color: #666;
        }

        .hours-list li.today .hours-time {
            color: #667eea;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 4/3;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .photo-item:hover {
            transform: scale(1.05);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .reviews-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .rating-stars {
            font-size: 1.5em;
            color: #ffc107;
        }

        .rating-score {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .rating-count {
            color: #666;
            font-size: 0.9em;
        }

        .review-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #667eea;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .review-author {
            font-weight: 600;
            color: #333;
        }

        .review-rating {
            color: #ffc107;
        }

        .review-text {
            color: #666;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading-spinner::after {
            content: 'â³';
            font-size: 3em;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .details-toggle-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .details-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #c62828;
        }

        .info-message {
            background: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #1565c0;
        }
    </style>
    <!-- Early script to ensure toggle function is available immediately -->
    <script>
        // Chinese language mode: 'traditional' or 'simplified'
        // Make it globally accessible
        window.chineseMode = 'traditional';
        
        // Placeholder toggle function - will be replaced by main script
        window.toggleChineseMode = function() {
            console.log('Toggle placeholder called - waiting for main script');
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ºï¸ Shenzhen NNYY Map</h1>
            <p>Explore top attractions, dining spots, and transport hubs</p>
            <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; align-items: center;">
                <button id="chineseToggle" onclick="toggleChineseMode()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                    ç¹é«”ä¸­æ–‡ / ç®€ä½“ä¸­æ–‡
                </button>
            </div>
        </div>

        <!-- Shenzhen Map Section -->
        <div class="map-section active" id="shenzhen-section">
        <div class="main-content" id="shenzhen-content">
            <div class="map-container">
                <div id="shenzhenMap"></div>
                <div class="custom-zoom-controls">
                    <button class="zoom-button" id="shenzhenZoomIn">+</button>
                    <button class="zoom-button" id="shenzhenZoomOut">âˆ’</button>
                    <button class="reset-view-button" id="shenzhenResetView" title="Reset to default view">ğŸ </button>
                    <button class="toggle-cluster-button active" id="shenzhenToggleCluster" title="Toggle cluster labels">ğŸ·ï¸</button>
                    <button class="my-location-button" id="shenzhenMyLocation" title="My Current Location">ğŸš¨</button>
                </div>
            </div>
            <div class="right-pane">
                <div class="pane-section">
                    <h2>ğŸ“ Attractions List</h2>
                    <ul class="legend-list" id="shenzhenLegendList"></ul>
                </div>
                <div class="pane-section details-panel">
                    <h2>â„¹ï¸ Details</h2>
                    <div id="shenzhenDetailsContent">
                        <div class="empty-state">Click on a pin or list item to see details</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Print Details Page -->
        <div class="print-only print-details-page" id="shenzhenPrintDetailsPage">
            <h2>ğŸ“ Shenzhen Attractions Details</h2>
            <div id="shenzhenPrintAttractionsList"></div>
        </div>
        </div>
        <!-- End Shenzhen Section -->
    </div>

    <button class="print-button" onclick="preparePrint()">ğŸ–¨ï¸ Print Attractions</button>

    <!-- Further Details Overlay -->
    <div class="details-overlay" id="detailsOverlay">
        <div class="details-modal">
            <div class="details-modal-header">
                <button class="details-close-btn" onclick="closeDetailsOverlay()">Ã—</button>
                <div class="category-badge" id="modalCategory"></div>
                <h2 id="modalTitle"></h2>
            </div>
            <div class="details-modal-body" id="modalBody">
                <div class="loading-spinner">Loading details...</div>
            </div>
        </div>
    </div>

    <script>
        // Accurate coordinates from Google Maps
        // For print: slightly adjusted coordinates to prevent overlap
        // Shenzhen locations - main locations array
        const shenzhenLocations = [
            {
                number: 1,
                name: "Intercity Shenzhen Futian Huanggang",
                nameChinese: "æ·±åœ³ç¦ç”°çš‡å´—åŸéš›é…’åº—",
                nameChineseSimplified: "æ·±åœ³ç¦ç”°çš‡å²—åŸé™…é…’åº—",
                category: "hotel",
                coordinates: { lat: 22.530198126782167, lng: 114.06989268500598 },
                address: "28 Fumin Rd, Futian District, Shenzhen, Guangdong Province, China, 518016",
                addressChinese: "ä¸­åœ‹å»£æ±çœæ·±åœ³å¸‚ç¦ç”°å€å¯Œæ°‘è·¯28è™Ÿï¼Œéƒµæ”¿ç·¨ç¢¼ï¼š518016",
                addressChineseSimplified: "ä¸­å›½å¹¿ä¸œçœæ·±åœ³å¸‚ç¦ç”°åŒºå¯Œæ°‘è·¯28å·ï¼Œé‚®æ”¿ç¼–ç ï¼š518016",
                description: "Hotel located in Futian district."
            },
            {
                number: 2,
                name: "Window of the World",
                nameChinese: "ä¸–ç•Œä¹‹çª—",
                nameChineseSimplified: "ä¸–ç•Œä¹‹çª—",
                category: "attraction",
                coordinates: { lat: 22.535541801673475, lng: 113.97570903878969 },
                address: "9037 Shennan Boulevard, Overseas Chinese Town, Nanshan District, Shenzhen, Guangdong, China",
                addressChinese: "ä¸­åœ‹å»£æ±çœæ·±åœ³å¸‚å—å±±å€è¯åƒ‘åŸæ·±å—å¤§é“9037è™Ÿ",
                addressChineseSimplified: "ä¸­å›½å¹¿ä¸œçœæ·±åœ³å¸‚å—å±±åŒºåä¾¨åŸæ·±å—å¤§é“9037å·",
                description: "Theme park featuring over 130 miniature replicas of famous world landmarks including the Eiffel Tower, Pyramids of Egypt, and more."
            },
            {
                number: 3,
                name: "Shenzhen Science & Technology Museum",
                nameChinese: "æ·±åœ³ç§‘å­¸æŠ€è¡“åšç‰©é¤¨",
                nameChineseSimplified: "æ·±åœ³ç§‘å­¦æŠ€æœ¯åšç‰©é¦†",
                category: "attraction",
                coordinates: { lat: 22.7748, lng: 113.9403 },
                address: "No. 8 Guanghui Avenue, Guangming District, Shenzhen",
                addressChinese: "å»£æ±çœæ·±åœ³å¸‚å…‰æ˜å€å…‰è¼å¤§é“8è™Ÿ(å…‰æ˜åœ°éµç«™Då£æ­¥è¡Œ170ç±³)",
                addressChineseSimplified: "å¹¿ä¸œçœæ·±åœ³å¸‚å…‰æ˜åŒºå…‰è¾‰å¤§é“8å·(å…‰æ˜åœ°é“ç«™Då£æ­¥è¡Œ170ç±³)",
                description: "Science and technology museum showcasing innovations and exhibits."
            },
            {
                number: 4,
                name: "Galaxy World CoCo Park Longgang district 6S Robot Centre",
                nameChinese: "æ˜Ÿæ²³ä¸–ç•ŒCoCo Parké¾å´—å€6Sæ©Ÿå™¨äººä¸­å¿ƒ",
                nameChineseSimplified: "æ˜Ÿæ²³ä¸–ç•ŒCoCo Parké¾™å²—åŒº6Sæœºå™¨äººä¸­å¿ƒ",
                category: "attraction",
                coordinates: { lat: 22.60533321445101, lng: 114.05948681801067 },
                address: "1 Ya Bao Lu, Longgang, Shenzhen, Guangdong Province, China, 518049",
                addressChinese: "ä¸­åœ‹å»£æ±çœæ·±åœ³å¸‚é¾å´—å€é›…å¯¶è·¯1è™Ÿï¼Œéƒµæ”¿ç·¨ç¢¼ï¼š518049",
                addressChineseSimplified: "ä¸­å›½å¹¿ä¸œçœæ·±åœ³å¸‚é¾™å²—åŒºé›…å®è·¯1å·ï¼Œé‚®æ”¿ç¼–ç ï¼š518049",
                description: "Shopping mall featuring the 6S Robot Centre. The robot 6s store is at the foot of Shenzhen Galaxy Twin Towers. Robot 6S Store (UBTECH): There are often robot performances (humanoid robots dancing, robot dogs) scheduled around 11:00, 15:00, 17:00."
            },
            {
                number: 5,
                name: "Yitian Plaza Meituan drone food delivery",
                nameChinese: "ç›Šç”°å»£å ´ç¾åœ˜ç„¡äººæ©Ÿé€é¤",
                nameChineseSimplified: "ç›Šç”°å¹¿åœºç¾å›¢æ— äººæœºé€é¤",
                category: "attraction",
                coordinates: { lat: 22.541593866378935, lng: 113.97468478278608 },
                address: "9028 Shennan Blvd, ä¸œé—¨ Nanshan, Shenzhen, Guangdong Province, China, 518058",
                addressChinese: "æ·±åœ³å¸‚å—å±±å€æ·±å—å¤§é“9028è™Ÿ",
                addressChineseSimplified: "æ·±åœ³å¸‚å—å±±åŒºæ·±å—å¤§é“9028å·",
                description: "Shopping plaza featuring Meituan drone food delivery service."
            },
            {
                number: 6,
                name: "Shenzhen Talent Park",
                nameChinese: "æ·±åœ³äººæ‰å…¬åœ’",
                nameChineseSimplified: "æ·±åœ³äººæ‰å…¬å›­",
                category: "attraction",
                coordinates: { lat: 22.51430838550339, lng: 113.9462686112619 },
                address: "GW6W+FFQ, Nanshan, Shenzhen, Guangdong Province, China, 518065",
                addressChinese: "GW6W+FFQï¼Œä¸­åœ‹å»£æ±çœæ·±åœ³å¸‚å—å±±å€ï¼Œéƒµæ”¿ç·¨ç¢¼ï¼š518065",
                addressChineseSimplified: "GW6W+FFQï¼Œä¸­å›½å¹¿ä¸œçœæ·±åœ³å¸‚å—å±±åŒºï¼Œé‚®æ”¿ç¼–ç ï¼š518065",
                description: "Park dedicated to showcasing Shenzhen's talent and innovation."
            },
            {
                number: 7,
                name: "Eye of the Bay Area (Qianhai Urban New Centre)",
                nameChinese: "æ·±åœ³æ›¸åŸç£å€ä¹‹çœ¼",
                nameChineseSimplified: "æ·±åœ³ä¹¦åŸæ¹¾åŒºä¹‹çœ¼",
                category: "attraction",
                coordinates: { lat: 22.547426028426475, lng: 113.88100197953024 },
                address: "Approximately 210 meters east of the JW Marriott Hotel Shenzhen Bao'an (8 Baoxing Rd, Baoan, Shenzhen, Guangdong Province, China, 518101)",
                addressChinese: "æ·±åœ³å¸‚å¯¶å®‰å€æµ·å¤©è·¯æ·±åœ³å‰æµ·è¯åƒ‘åŸJWè¬è±ªé…’åº—æ±å´ç´„210ç±³ (å»£æ±çœæ·±åœ³å¸‚å¯¶å®‰å€å¯¶èˆˆè·¯8è™Ÿ)",
                addressChineseSimplified: "æ·±åœ³å¸‚å®å®‰åŒºæµ·å¤©è·¯æ·±åœ³å‰æµ·åä¾¨åŸJWä¸‡è±ªé…’åº—ä¸œä¾§çº¦210ç±³ (å¹¿ä¸œçœæ·±åœ³å¸‚å®å®‰åŒºå®å…´è·¯8å·)",
                description: "Eye of the Bay area featuring China's largest bookstore in Qianhai Urban New Centre."
            },
            {
                number: 8,
                name: "Bao'an Yantian Food Street (Night Market)",
                nameChinese: "é¹½ç”°å¤œå¸‚",
                nameChineseSimplified: "ç›ç”°å¤œå¸‚",
                category: "food",
                coordinates: { lat: 22.58753174293875, lng: 114.27900677279099 },
                address: "China, Guangdong Province, Shenzhen City, Yantian District, Beishan Village, Huangbiwei Village, Postcode 518085",
                addressChinese: "ä¸­åœ‹ï¼Œå»£æ±çœï¼Œæ·±åœ³å¸‚ï¼Œé¹½ç”°å€ï¼ŒåŒ—å±±æ‘ï¼Œé»ƒç¢§åœæ‘ï¼Œéƒµæ”¿ç·¨ç¢¼ 518085",
                addressChineseSimplified: "ä¸­å›½ï¼Œå¹¿ä¸œçœï¼Œæ·±åœ³å¸‚ï¼Œç›ç”°åŒºï¼ŒåŒ—å±±æ‘ï¼Œé»„ç¢§å›´æ‘ï¼Œé‚®æ”¿ç¼–ç  518085",
                description: "Food street in Yantian district offering various local cuisine."
            },
            {
                number: 9,
                name: "Dongmen Pedestrian Street Shopping",
                nameChinese: "æ±é–€æ­¥è¡Œè¡—è³¼ç‰©",
                nameChineseSimplified: "ä¸œé—¨æ­¥è¡Œè¡—è´­ç‰©",
                category: "attraction",
                coordinates: { lat: 22.5447518709039, lng: 114.12102613939273 },
                address: "Dongmen Pedestrian Street, Luohu District, Shenzhen, Guangdong, China",
                addressChinese: "ä¸­åœ‹å»£æ±çœæ·±åœ³å¸‚ç¾…æ¹–å€æ±é–€æ­¥è¡Œè¡—",
                addressChineseSimplified: "ä¸­å›½å¹¿ä¸œçœæ·±åœ³å¸‚ç½—æ¹–åŒºä¸œé—¨æ­¥è¡Œè¡—",
                description: "Famous pedestrian shopping street in Shenzhen."
            },
            {
                number: 10,
                name: "Orbit One UFO robot restaurant",
                nameChinese: "è»Œé“ä¸€è™ŸUFOæ©Ÿå™¨äººé¤å»³",
                nameChineseSimplified: "è½¨é“ä¸€å·UFOæœºå™¨äººé¤å…",
                category: "food",
                coordinates: { lat: 22.545283417849387, lng: 114.09914861181241 },
                address: "IN City Plaza (Futian District): LG-M-01/02",
                addressChinese: "æ·±åœ³å¸‚ç¦ç”°å€æ·±å—ä¸­è·¯1095è™ŸiNåŸå¸‚å»£å ´LGå±¤",
                addressChineseSimplified: "æ·±åœ³å¸‚ç¦ç”°åŒºæ·±å—ä¸­è·¯1095å·iNåŸå¸‚å¹¿åœºLGå±‚",
                description: "A futuristic sci-fi dining adventure featuring UFO-inspired robots that deliver dishes along magnetic levitation tracks. The restaurant offers Western fusion cuisine including truffle pizza and pineapple fried rice served in a hollowed-out pineapple. Located at IN City Plaza (Futian District): LG-M-01/02, opposite Nayuki Tea, a 260m walk from Metro Line 6 Science Museum Station (Exit E). A unique family-friendly experience combining technology and dining.",
                customImage: "https://www.littlestepsasia.com/wp-content/uploads/2024/11/orbit-one-restaurant-shenzhen.jpg"
            },
            {
                number: 11,
                name: "Huaqiangbei Commercial Street",
                nameChinese: "è¯å¼·åŒ—å•†æ¥­è¡—",
                nameChineseSimplified: "åå¼ºåŒ—å•†ä¸šè¡—",
                category: "attraction",
                coordinates: { lat: 22.5413326075686, lng: 114.08679836279566 },
                address: "G3RP+9MG, Huaqiang Rd N, Fu Tian Qu, Shenzhen, Guangdong Province, China, 518000",
                addressChinese: "G3RP+9MGï¼Œè¯å¼·åŒ—è·¯ï¼Œç¦ç”°å€ï¼Œæ·±åœ³å¸‚ï¼Œå»£æ±çœï¼Œä¸­åœ‹ï¼Œ518000",
                addressChineseSimplified: "G3RP+9MGï¼Œåå¼ºåŒ—è·¯ï¼Œç¦ç”°åŒºï¼Œæ·±åœ³å¸‚ï¼Œå¹¿ä¸œçœï¼Œä¸­å›½ï¼Œ518000",
                description: "Famous electronics wholesale market in Shenzhen."
            },
            {
                number: 12,
                name: "Huaqiang Electronic World",
                nameChinese: "è¯å¼·é›»å­ä¸–ç•Œ",
                nameChineseSimplified: "åå¼ºç”µå­ä¸–ç•Œ",
                category: "attraction",
                coordinates: { lat: 22.543107017732616, lng: 114.08608482208979 },
                address: "1015 Huaqiang Rd N, Futian District, Shenzhen, Guangdong Province, China, 518028",
                addressChinese: "ä¸­åœ‹å»£æ±çœæ·±åœ³å¸‚ç¦ç”°å€è¯å¼·åŒ—è·¯1015è™Ÿï¼Œéƒµæ”¿ç·¨ç¢¼ï¼š518028",
                addressChineseSimplified: "ä¸­å›½å¹¿ä¸œçœæ·±åœ³å¸‚ç¦ç”°åŒºåå¼ºåŒ—è·¯1015å·ï¼Œé‚®æ”¿ç¼–ç ï¼š518028",
                description: "Building 1 is accessible via Exit A of Huaqiang Road Station."
            }
        ];

        // Global variables for Shenzhen map only
        let shenzhenMap;
        let shenzhenMarkers = [];
        let shenzhenSelectedLocation = null;
        
        // Alias for compatibility
        const locations = shenzhenLocations;
        
        // Use the global chineseMode variable defined in head
        // Update the global toggle function to refresh details properly
        window.toggleChineseMode = function() {
            console.log('Toggle clicked! Current mode:', window.chineseMode);
            window.chineseMode = window.chineseMode === 'traditional' ? 'simplified' : 'traditional';
            chineseMode = window.chineseMode; // Sync with local variable
            console.log('New mode:', window.chineseMode);
            
            const button = document.getElementById('chineseToggle');
            if (button) {
                button.textContent = window.chineseMode === 'traditional' ? 'ç¹é«”ä¸­æ–‡ / ç®€ä½“ä¸­æ–‡' : 'ç®€ä½“ä¸­æ–‡ / ç¹é«”ä¸­æ–‡';
                console.log('Button text updated');
            }
            
            // Refresh current location details if any are displayed
            // Check if functions exist before calling them (they may not be defined yet)
            setTimeout(function() {
                if (shenzhenSelectedLocation && typeof showShenzhenDetails === 'function') {
                    console.log('Refreshing Shenzhen details');
                    showShenzhenDetails(shenzhenSelectedLocation, false);
                }
            }, 100);
        };
        
        // Sync chineseMode variable
        let chineseMode = window.chineseMode || 'traditional';
        
        // Google Places service
        let placesService;
        let currentLocationForDetails = null;
        
        // Current location tracking
        let shenzhenCurrentLocationMarker = null;
        let shenzhenCurrentLocationActive = false;
        let shenzhenCurrentLocationData = null;

        // Shenzhen map settings
        const shenzhenDefaultCenter = { lat: 22.538, lng: 114.015 };
        const shenzhenDefaultZoom = 12;

        // Color scheme
        const colors = {
            hotel: '#FF6B6B',
            transport: '#4ECDC4',
            attraction: '#45B7D1',
            food: '#FFA07A'
        };

        // Calculate distance between two coordinates using Haversine formula (in km)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return distance;
        }

        // Format distance for display
        function formatDistance(distance) {
            if (distance < 1) {
                return (distance * 1000).toFixed(0) + ' m';
            } else {
                return distance.toFixed(1) + ' km';
            }
        }

        // Cached location data (valid for 30 seconds)
        let cachedLocation = null;
        let cachedLocationTime = 0;
        const LOCATION_CACHE_DURATION = 30000; // 30 seconds

        // Get current location using Geolocation API (optimized for speed)
        function getCurrentLocation(callback, errorCallback, useCache = true) {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser');
                if (errorCallback) errorCallback();
                return;
            }

            // Return cached location if available and fresh
            if (useCache && cachedLocation && (Date.now() - cachedLocationTime) < LOCATION_CACHE_DURATION) {
                console.log('Using cached location');
                callback(cachedLocation);
                return;
            }

            // Use optimized options for faster response
            const options = {
                enableHighAccuracy: false, // false = faster, less accurate
                timeout: 5000, // 5 second timeout
                maximumAge: 10000 // Accept cached position up to 10 seconds old
            };

            const startTime = Date.now();
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const elapsed = Date.now() - startTime;
                    console.log(`Location retrieved in ${elapsed}ms`);
                    
                    const coords = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    // Cache the location
                    cachedLocation = coords;
                    cachedLocationTime = Date.now();
                    
                    callback(coords);
                },
                (error) => {
                    const elapsed = Date.now() - startTime;
                    console.log(`Location error after ${elapsed}ms:`, error.code);
                    
                    let errorMessage = 'Unable to retrieve your location';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'Location permission denied. Please enable location access in your browser settings.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'Location request timed out. Please try again.';
                            break;
                    }
                    alert(errorMessage);
                    if (errorCallback) errorCallback();
                },
                options
            );
        }

        // Reverse geocode coordinates to get address (with timeout)
        function getAddressFromCoords(lat, lng, callback) {
            const geocoder = new google.maps.Geocoder();
            const latlng = { lat: lat, lng: lng };
            
            // Set timeout for geocoding (5 seconds)
            const timeout = setTimeout(() => {
                console.log('Geocoding timeout, using coordinates');
                callback(`Coordinates: ${lat.toFixed(6)}, ${lng.toFixed(6)}`);
            }, 5000);
            
            geocoder.geocode({ location: latlng }, (results, status) => {
                clearTimeout(timeout);
                
                if (status === 'OK') {
                    if (results[0]) {
                        callback(results[0].formatted_address);
                    } else {
                        callback('Address not found');
                    }
                } else {
                    callback(`Coordinates: ${lat.toFixed(6)}, ${lng.toFixed(6)}`);
                }
            });
        }

        // Get Shenzhen Hotel coordinates (location #1)
        const shenzhenHotel = shenzhenLocations.find(loc => loc.number === 1 && loc.category === 'hotel');
        const hotelCoords = shenzhenHotel ? shenzhenHotel.coordinates : { lat: 22.530198126782167, lng: 114.06989268500598 };

        // Clusters removed - Shenzhen only, no clusters needed
        // Track cluster visibility state (not used for Shenzhen)
        let showClusters = false;

        // Create custom numbered marker icon with label
        function createMarkerIcon(number, color, isHighlighted = false) {
            return {
                path: google.maps.SymbolPath.CIRCLE,
                scale: isHighlighted ? 16 : 10,
                fillColor: color,
                fillOpacity: 1,
                strokeColor: isHighlighted ? '#FF0000' : '#FFFF00',
                strokeWeight: isHighlighted ? 4 : 2,
                anchor: new google.maps.Point(0, 0),
                labelOrigin: new google.maps.Point(0, 0)
            };
        }
        
        // Create marker label configuration
        function createMarkerLabel(number, isHighlighted = false) {
            return {
                text: number.toString(),
                color: '#FFFFFF',
                fontSize: isHighlighted ? '14px' : '11px',
                fontWeight: 'bold'
            };
        }

        // Function to update marker appearance
        function updateMarkerAppearance(marker, location, isHighlighted) {
            marker.setIcon(createMarkerIcon(location.number, colors[location.category], isHighlighted));
            marker.setLabel(createMarkerLabel(location.number, isHighlighted));
            // Bring highlighted marker to front, or reset to normal z-index
            marker.setZIndex(isHighlighted ? 1000 : location.number);
        }

        // Macau functions removed - Shenzhen only
        
        // Toggle Shenzhen current location
        function toggleShenzhenCurrentLocation() {
            const button = document.getElementById('shenzhenMyLocation');
            
            console.log('Shenzhen Toggle clicked. Current state:', shenzhenCurrentLocationActive);
            
            if (shenzhenCurrentLocationActive) {
                console.log('Deactivating Shenzhen location');
                // Remove current location marker and restore default view
                if (shenzhenCurrentLocationMarker) {
                    shenzhenCurrentLocationMarker.setMap(null);
                    shenzhenCurrentLocationMarker = null;
                }
                shenzhenCurrentLocationActive = false;
                shenzhenCurrentLocationData = null;
                button.classList.remove('active');
                button.style.backgroundColor = '';
                button.textContent = 'ğŸš¨';
                button.title = 'My Current Location';
                
                // Reset to default view
                shenzhenMap.setCenter(shenzhenDefaultCenter);
                shenzhenMap.setZoom(shenzhenDefaultZoom);
                
                // Clear details
                const detailsContent = document.getElementById('shenzhenDetailsContent');
                detailsContent.innerHTML = '<div class="empty-state">Click on a pin or list item to see details</div>';
                
                // Clear active states
                document.querySelectorAll('#shenzhen-section .legend-list-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Reset selected location if any
                if (shenzhenSelectedLocation) {
                    const prevMarker = shenzhenMarkers.find(m => m.locationNumber === shenzhenSelectedLocation.number);
                    if (prevMarker) {
                        updateMarkerAppearance(prevMarker, shenzhenSelectedLocation, false);
                    }
                    shenzhenSelectedLocation = null;
                }
            } else {
                console.log('Activating Shenzhen location');
                // Prevent multiple clicks while loading
                if (button.disabled) {
                    console.log('Button is disabled, ignoring click');
                    return;
                }
                
                // Show immediate visual feedback
                button.disabled = true;
                button.style.opacity = '0.6';
                button.textContent = 'â³';
                button.title = 'Getting location...';
                
                // Show loading state in details panel immediately
                const detailsContent = document.getElementById('shenzhenDetailsContent');
                detailsContent.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 20px;">
                        <div style="font-size: 2em; margin-bottom: 10px;">â³</div>
                        <div>Getting your location...</div>
                    </div>
                `;
                
                // Get and show current location
                getCurrentLocation((coords) => {
                    console.log('Shenzhen location received:', coords);
                    // Re-enable button IMMEDIATELY
                    button.disabled = false;
                    button.style.opacity = '1';
                    button.textContent = 'ğŸš¨';
                    button.title = 'My Current Location';
                    
                    // Create red pin marker for current location
                    if (shenzhenCurrentLocationMarker) {
                        shenzhenCurrentLocationMarker.setMap(null);
                    }
                    
                    shenzhenCurrentLocationMarker = new google.maps.Marker({
                        position: coords,
                        map: shenzhenMap,
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 12,
                            fillColor: '#FF0000',
                            fillOpacity: 1,
                            strokeColor: '#FFFFFF',
                            strokeWeight: 3
                        },
                        title: 'My Current Location',
                        zIndex: 2000
                    });
                    
                    // Move map to current location
                    shenzhenMap.setCenter(coords);
                    shenzhenMap.setZoom(16);
                    
                    // Set state immediately - THIS IS CRITICAL
                    shenzhenCurrentLocationActive = true;
                    button.classList.add('active');
                    button.style.backgroundColor = '#FF6B6B';
                    
                    console.log('Shenzhen state set to active:', shenzhenCurrentLocationActive);
                    
                    // Clear selected location if any
                    if (shenzhenSelectedLocation) {
                        const prevMarker = shenzhenMarkers.find(m => m.locationNumber === shenzhenSelectedLocation.number);
                        if (prevMarker) {
                            updateMarkerAppearance(prevMarker, shenzhenSelectedLocation, false);
                        }
                        shenzhenSelectedLocation = null;
                    }
                    
                    // Calculate distance immediately
                    const hotelCoords = shenzhenLocations.find(loc => loc.category === 'hotel')?.coordinates || { lat: 22.530198126782167, lng: 114.06989268500598 };
                    const hotelName = shenzhenLocations.find(loc => loc.category === 'hotel')?.name || 'Intercity Shenzhen Futian Huanggang';
                    const distance = calculateDistance(
                        hotelCoords.lat,
                        hotelCoords.lng,
                        coords.lat,
                        coords.lng
                    );
                    
                    // Show details IMMEDIATELY with loading state for address
                    const detailsContent = document.getElementById('shenzhenDetailsContent');
                    detailsContent.innerHTML = `
                        <h3>ğŸš¨ My Current Location</h3>
                        <span class="category" style="background-color: #FF0000;">Current Location</span>
                        <div class="distance">ğŸš— ${formatDistance(distance)} from ${hotelName}</div>
                        <div class="address">ğŸ“ <i>Loading address...</i></div>
                        <div class="description">This is your current location. Click the location button again to return to the default map view.</div>
                    `;
                    
                    // Clear active states from legend
                    document.querySelectorAll('#shenzhen-section .legend-list-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Get address in background and update when ready
                    getAddressFromCoords(coords.lat, coords.lng, (address) => {
                        shenzhenCurrentLocationData = {
                            coords: coords,
                            address: address,
                            distance: distance
                        };
                        
                        // Update address in details panel
                        detailsContent.innerHTML = `
                            <h3>ğŸš¨ My Current Location</h3>
                            <span class="category" style="background-color: #FF0000;">Current Location</span>
                            <div class="distance">ğŸš— ${formatDistance(distance)} from ${hotelName}</div>
                            <div class="address">ğŸ“ ${address}</div>
                            <div class="description">This is your current location. Click the location button again to return to the default map view.</div>
                        `;
                    });
                }, () => {
                    // Error callback - re-enable button
                    console.log('Error getting Shenzhen location');
                    button.disabled = false;
                    button.style.opacity = '1';
                    button.textContent = 'ğŸš¨';
                    button.title = 'My Current Location';
                    
                    // Show error in details panel
                    const detailsContent = document.getElementById('shenzhenDetailsContent');
                    detailsContent.innerHTML = `
                        <div class="empty-state" style="text-align: center; padding: 20px; color: #c62828;">
                            <div style="font-size: 2em; margin-bottom: 10px;">âŒ</div>
                            <div>Unable to get your location. Please check your browser settings.</div>
                        </div>
                    `;
                });
            }
        }

        // Initialize maps (Shenzhen only)
        function initMaps() {
            initShenzhenMap();
        }

        // Macau map initialization removed - all Macau code has been removed
        
        // Macau cluster and print functions removed - Shenzhen only
        
        // Prepare for printing (attractions list only)
        function preparePrint() {
            window.print();
        }

        // Macau cluster and print functions removed - Shenzhen only

        // Initialize Shenzhen Google Map
        function initShenzhenMap() {
            shenzhenMap = new google.maps.Map(document.getElementById('shenzhenMap'), {
                center: shenzhenDefaultCenter,
                zoom: shenzhenDefaultZoom,
                zoomControl: false,
                scrollwheel: false,
                disableDoubleClickZoom: true,
                gestureHandling: 'cooperative',
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: false
            });

            shenzhenMap.setCenter(shenzhenDefaultCenter);
            shenzhenMap.setZoom(shenzhenDefaultZoom);

            // Custom zoom controls
            document.getElementById('shenzhenZoomIn').addEventListener('click', () => {
                shenzhenMap.setZoom(shenzhenMap.getZoom() + 1);
            });

            document.getElementById('shenzhenZoomOut').addEventListener('click', () => {
                shenzhenMap.setZoom(shenzhenMap.getZoom() - 1);
            });

            // Reset view button
            document.getElementById('shenzhenResetView').addEventListener('click', () => {
                shenzhenMap.setCenter(shenzhenDefaultCenter);
                shenzhenMap.setZoom(shenzhenDefaultZoom);
                
                if (shenzhenSelectedLocation) {
                    const prevMarker = shenzhenMarkers.find(m => m.locationNumber === shenzhenSelectedLocation.number);
                    if (prevMarker) {
                        updateMarkerAppearance(prevMarker, shenzhenSelectedLocation, false);
                    }
                    shenzhenSelectedLocation = null;
                }
                
                // Remove current location marker if active
                if (shenzhenCurrentLocationActive) {
                    if (shenzhenCurrentLocationMarker) {
                        shenzhenCurrentLocationMarker.setMap(null);
                        shenzhenCurrentLocationMarker = null;
                    }
                    shenzhenCurrentLocationActive = false;
                    shenzhenCurrentLocationData = null;
                    document.getElementById('shenzhenMyLocation').classList.remove('active');
                }
                
                document.querySelectorAll('#shenzhen-section .legend-list-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const detailsContent = document.getElementById('shenzhenDetailsContent');
                detailsContent.innerHTML = '<div class="empty-state">Click on a pin or list item to see details</div>';
            });

            // Toggle cluster button (Shenzhen doesn't have clusters yet, but keeping structure)
            document.getElementById('shenzhenToggleCluster').addEventListener('click', function() {
                // No clusters for Shenzhen yet
            });

            // My Location button
            document.getElementById('shenzhenMyLocation').addEventListener('click', () => {
                toggleShenzhenCurrentLocation();
            });

            // Prevent trackpad pinch zoom
            shenzhenMap.addListener('wheel', function(e) {
                if (e.domEvent.ctrlKey) {
                    e.domEvent.preventDefault();
                }
            });

            // Create legend list
            const legendList = document.getElementById('shenzhenLegendList');
            shenzhenLocations.forEach(location => {
                const listItem = document.createElement('li');
                listItem.className = 'legend-list-item';
                listItem.setAttribute('data-number', location.number);
                listItem.innerHTML = `
                    <div class="legend-number ${location.category}">${location.number}</div>
                    <div class="legend-name">${location.name}</div>
                `;
                listItem.addEventListener('click', () => {
                    showShenzhenDetails(location, false);
                });
                legendList.appendChild(listItem);
            });

            // Add markers to map
            shenzhenLocations.forEach(location => {
                const marker = new google.maps.Marker({
                    position: location.coordinates,
                    map: shenzhenMap,
                    icon: createMarkerIcon(location.number, colors[location.category], false),
                    label: createMarkerLabel(location.number, false),
                    title: location.name,
                    zIndex: location.number
                });

                marker.locationNumber = location.number;

                marker.addListener('click', () => {
                    showShenzhenDetails(location, true);
                });

                shenzhenMarkers.push(marker);
            });

            // Prepare print details page
            prepareShenzhenPrintDetailsPage();

            // Add print event listener for Shenzhen
            window.addEventListener('beforeprint', function() {
                if (shenzhenMarkers.length > 0) {
                    const bounds = new google.maps.LatLngBounds();
                    shenzhenLocations.forEach(location => {
                        bounds.extend(location.coordinates);
                    });
                    shenzhenMap.fitBounds(bounds);
                    const currentZoom = shenzhenMap.getZoom();
                    shenzhenMap.setZoom(currentZoom - 0.8);
                    
                    setTimeout(function() {
                        google.maps.event.trigger(shenzhenMap, 'resize');
                        shenzhenMap.fitBounds(bounds);
                        shenzhenMap.setZoom(shenzhenMap.getZoom() - 0.8);
                    }, 100);
                }
            });

            window.addEventListener('afterprint', function() {
                shenzhenMap.setCenter(shenzhenDefaultCenter);
                shenzhenMap.setZoom(shenzhenDefaultZoom);
                google.maps.event.trigger(shenzhenMap, 'resize');
            });
        }

        // Show Shenzhen attraction details
        function showShenzhenDetails(location, zoomIn = true) {
            if (shenzhenSelectedLocation && shenzhenSelectedLocation.number === location.number && zoomIn) {
                const prevMarker = shenzhenMarkers.find(m => m.locationNumber === shenzhenSelectedLocation.number);
                if (prevMarker) {
                    updateMarkerAppearance(prevMarker, shenzhenSelectedLocation, false);
                }
                
                shenzhenMap.setCenter(shenzhenDefaultCenter);
                shenzhenMap.setZoom(shenzhenDefaultZoom);
                shenzhenSelectedLocation = null;
                
                document.querySelectorAll('#shenzhen-section .legend-list-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const detailsContent = document.getElementById('shenzhenDetailsContent');
                detailsContent.innerHTML = '<div class="empty-state">Click on a pin or list item to see details</div>';
                return;
            }

            if (shenzhenSelectedLocation) {
                const prevMarker = shenzhenMarkers.find(m => m.locationNumber === shenzhenSelectedLocation.number);
                if (prevMarker) {
                    updateMarkerAppearance(prevMarker, shenzhenSelectedLocation, false);
                }
            }

            shenzhenSelectedLocation = location;

            const currentMarker = shenzhenMarkers.find(m => m.locationNumber === location.number);
            if (currentMarker) {
                updateMarkerAppearance(currentMarker, location, true);
            }

            // Calculate distance from Intercity Shenzhen Futian Huanggang
            const hotelCoords = shenzhenLocations.find(loc => loc.category === 'hotel')?.coordinates || { lat: 22.530198126782167, lng: 114.06989268500598 };
            const distance = calculateDistance(
                hotelCoords.lat, 
                hotelCoords.lng, 
                location.coordinates.lat, 
                location.coordinates.lng
            );
            const hotelName = shenzhenLocations.find(loc => loc.category === 'hotel')?.name || 'Intercity Shenzhen Futian Huanggang';
            const distanceText = location.category === 'hotel' ? 
                'Your hotel' : 
                `${formatDistance(distance)} from ${hotelName}`;

            const detailsContent = document.getElementById('shenzhenDetailsContent');
            // Get Chinese text based on current mode
            let nameChineseText = '';
            let addressChineseText = '';
            // Use global chineseMode if available, otherwise use local
            const currentMode = window.chineseMode || chineseMode;
            console.log('Displaying Shenzhen details - chineseMode:', currentMode);
            if (currentMode === 'simplified') {
                nameChineseText = location.nameChineseSimplified || location.nameChinese || '';
                addressChineseText = location.addressChineseSimplified || location.addressChinese || '';
                console.log('Using simplified:', nameChineseText, addressChineseText);
            } else {
                nameChineseText = location.nameChinese || '';
                addressChineseText = location.addressChinese || '';
                console.log('Using traditional:', nameChineseText, addressChineseText);
            }
            const chineseName = nameChineseText ? `<div style="font-size: 0.9em; color: #666; margin-top: 5px;">${nameChineseText}</div>` : '';
            const chineseAddress = addressChineseText ? `<div style="font-size: 0.9em; color: #666; margin-top: 5px;">ğŸ“ ${addressChineseText}</div>` : '';
            detailsContent.innerHTML = `
                <h3>${location.name}${chineseName}</h3>
                <span class="category ${location.category}">${location.category.charAt(0).toUpperCase() + location.category.slice(1)}</span>
                <div class="distance">ğŸš— ${distanceText}</div>
                <div class="address">ğŸ“ ${location.address}${chineseAddress}</div>
                <div class="description">${location.description}</div>
                <button class="details-toggle-btn" onclick="openDetailsOverlay(${location.number})">
                    ğŸ“‹ Further Details
                </button>
            `;

            document.querySelectorAll('#shenzhen-section .legend-list-item').forEach(item => {
                item.classList.remove('active');
            });
            const listItem = document.querySelector(`#shenzhen-section [data-number="${location.number}"]`);
            if (listItem) {
                listItem.classList.add('active');
            }

            if (zoomIn) {
                shenzhenMap.setCenter(location.coordinates);
                shenzhenMap.setZoom(16);
            }
        }

        // Prepare Shenzhen print details page
        function prepareShenzhenPrintDetailsPage() {
            const printList = document.getElementById('shenzhenPrintAttractionsList');
            const hotelCoords = shenzhenLocations.find(loc => loc.category === 'hotel')?.coordinates || { lat: 22.530198126782167, lng: 114.06989268500598 };
            const hotelName = shenzhenLocations.find(loc => loc.category === 'hotel')?.name || 'Intercity Shenzhen Futian Huanggang';
            
            shenzhenLocations.forEach(location => {
                const distance = calculateDistance(
                    hotelCoords.lat, 
                    hotelCoords.lng, 
                    location.coordinates.lat, 
                    location.coordinates.lng
                );
                const distanceText = location.category === 'hotel' ? 
                    'Your hotel' : 
                    `${formatDistance(distance)} from ${hotelName}`;
                
                const attractionDiv = document.createElement('div');
                attractionDiv.className = 'print-attraction';
                attractionDiv.innerHTML = `
                    <h3><span class="attraction-number">${location.number}</span> ${location.name}</h3>
                    <div class="print-category ${location.category}">${location.category.charAt(0).toUpperCase() + location.category.slice(1)}</div>
                    <div class="print-distance">ğŸš— ${distanceText}</div>
                    <div class="print-address">ğŸ“ ${location.address}</div>
                    <div class="print-description">${location.description}</div>
                `;
                printList.appendChild(attractionDiv);
            });
        }

        // Tab switching removed - only Shenzhen map

        // Prepare for printing (Shenzhen only)
        function preparePrint() {
            document.getElementById('shenzhenPrintDetailsPage').style.display = 'block';
            window.print();
            setTimeout(() => {
                document.getElementById('shenzhenPrintDetailsPage').style.display = '';
            }, 100);
        }

        // Further Details Overlay Functions
        function openDetailsOverlay(locationNumber) {
            const locations = shenzhenLocations;
            const location = locations.find(loc => loc.number === locationNumber);
            
            if (!location) return;
            
            console.log('Opening details overlay for:', location.name);
            
            currentLocationForDetails = location;
            const overlay = document.getElementById('detailsOverlay');
            const modalTitle = document.getElementById('modalTitle');
            const modalCategory = document.getElementById('modalCategory');
            const modalBody = document.getElementById('modalBody');
            
            // Show overlay with loading state
            modalTitle.textContent = location.name;
            modalCategory.textContent = location.category.charAt(0).toUpperCase() + location.category.slice(1);
            modalBody.innerHTML = '<div class="loading-spinner">Loading details from Google Places...</div>';
            overlay.classList.add('active');
            
            // Initialize Places Service if not already done
            const map = shenzhenMap;
            if (!placesService) {
                console.log('Initializing Places Service');
                try {
                    placesService = new google.maps.places.PlacesService(map);
                } catch (error) {
                    console.error('Error initializing Places Service:', error);
                    showDetailsError('Google Places API is not available. The API might not be enabled for this key.');
                    return;
                }
            }
            
            // Show basic information immediately as fallback
            setTimeout(() => {
                if (modalBody.innerHTML.includes('Loading details')) {
                    console.log('Still loading after 3 seconds, showing basic info');
                    showBasicInformation(location);
                }
            }, 3000); // Show basic info after 3 seconds if Google API hasn't responded
            
            // Set a global timeout for the entire process
            const globalTimeout = setTimeout(() => {
                console.error('Global timeout reached');
                if (modalBody.innerHTML.includes('Loading details')) {
                    showBasicInformation(location, 'Google Places API took too long to respond. Showing basic information instead.');
                }
            }, 8000); // 8 second timeout before showing error
            
            // Store timeout ID so we can clear it if successful
            window.currentDetailsTimeout = globalTimeout;
            
            // Search for the place using Places API
            try {
                searchPlaceDetails(location);
            } catch (error) {
                clearTimeout(globalTimeout);
                console.error('Error searching for place:', error);
                showBasicInformation(location, 'An error occurred: ' + error.message);
            }
        }

        function closeDetailsOverlay() {
            const overlay = document.getElementById('detailsOverlay');
            overlay.classList.remove('active');
            currentLocationForDetails = null;
        }

        // Close overlay when clicking outside the modal
        document.addEventListener('click', function(event) {
            const overlay = document.getElementById('detailsOverlay');
            if (event.target === overlay) {
                closeDetailsOverlay();
            }
        });

        function searchPlaceDetails(location) {
            console.log('Searching for place:', location.name);
            
            const request = {
                query: location.name,
                locationBias: location.coordinates,
                fields: ['place_id', 'name']
            };

            placesService.findPlaceFromQuery(request, function(results, status) {
                console.log('findPlaceFromQuery status:', status);
                console.log('findPlaceFromQuery results:', results);
                
                if (status === google.maps.places.PlacesServiceStatus.OK && results && results.length > 0) {
                    const placeId = results[0].place_id;
                    console.log('Found place_id:', placeId);
                    getPlaceDetails(placeId, location);
                } else {
                    console.log('findPlaceFromQuery failed, trying text search. Status:', status);
                    // Fallback to text search if findPlaceFromQuery fails
                    textSearchPlace(location);
                }
            });
        }

        function textSearchPlace(location) {
            console.log('Text search for:', location.name);
            
            const request = {
                query: location.name + ' Shenzhen',
                location: location.coordinates,
                radius: 500
            };

            placesService.textSearch(request, function(results, status) {
                console.log('textSearch status:', status);
                console.log('textSearch results:', results);
                
                if (status === google.maps.places.PlacesServiceStatus.OK && results && results.length > 0) {
                    const placeId = results[0].place_id;
                    console.log('Found place_id from text search:', placeId);
                    getPlaceDetails(placeId, location);
                } else {
                    console.error('Text search failed. Status:', status);
                    showDetailsError('Unable to find detailed information for this location from Google Places. Status: ' + status);
                }
            });
        }

        function getPlaceDetails(placeId, location) {
            console.log('Getting details for place_id:', placeId);
            
            const request = {
                placeId: placeId,
                fields: ['name', 'formatted_address', 'opening_hours', 'photos', 'rating', 
                        'user_ratings_total', 'reviews', 'website', 'formatted_phone_number', 
                        'international_phone_number', 'url', 'types', 'business_status']
            };

            // Set a timeout in case the API call hangs
            const timeout = setTimeout(() => {
                console.error('API call timeout');
                showDetailsError('Request timed out. Please try again.');
            }, 10000); // 10 second timeout

            placesService.getDetails(request, function(place, status) {
                clearTimeout(timeout);
                console.log('getDetails status:', status);
                console.log('getDetails place:', place);
                
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    displayPlaceDetails(place, location);
                } else {
                    console.error('getDetails failed. Status:', status);
                    showDetailsError('Unable to fetch detailed information from Google Places. Status: ' + status);
                }
            });
        }

        function displayPlaceDetails(place, location) {
            console.log('Displaying place details');
            
            // Clear the global timeout since we got results
            if (window.currentDetailsTimeout) {
                clearTimeout(window.currentDetailsTimeout);
                window.currentDetailsTimeout = null;
            }
            
            const modalBody = document.getElementById('modalBody');
            let html = '';

            // Full Address Section
            html += '<div class="details-section">';
            html += '<h3>ğŸ“ Full Address</h3>';
            html += '<div class="address-block">';
            html += `<p><strong>${place.name || location.name}</strong></p>`;
            html += `<p>${place.formatted_address || location.address}</p>`;
            if (place.formatted_phone_number) {
                html += `<p>ğŸ“ ${place.formatted_phone_number}</p>`;
            }
            if (place.website) {
                html += `<p>ğŸŒ <a href="${place.website}" target="_blank" style="color: #667eea;">Visit Website</a></p>`;
            }
            if (place.url) {
                html += `<p>ğŸ—ºï¸ <a href="${place.url}" target="_blank" style="color: #667eea;">View on Google Maps</a></p>`;
            }
            html += '</div></div>';

            // Opening Hours Section
            html += '<div class="details-section">';
            html += '<h3>ğŸ•’ Opening Hours</h3>';
            if (place.opening_hours && place.opening_hours.weekday_text) {
                const today = new Date().getDay();
                const daysMap = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                const todayName = daysMap[today];
                
                html += '<ul class="hours-list">';
                place.opening_hours.weekday_text.forEach(dayHours => {
                    const isToday = dayHours.startsWith(todayName);
                    html += `<li${isToday ? ' class="today"' : ''}>`;
                    const parts = dayHours.split(': ');
                    html += `<span class="hours-day">${parts[0]}</span>`;
                    html += `<span class="hours-time">${parts[1] || 'Closed'}</span>`;
                    html += '</li>';
                });
                html += '</ul>';
                
                if (place.opening_hours.open_now !== undefined) {
                    const statusColor = place.opening_hours.open_now ? '#4CAF50' : '#f44336';
                    const statusText = place.opening_hours.open_now ? 'Currently Open' : 'Currently Closed';
                    html += `<p style="color: ${statusColor}; font-weight: 600; margin-top: 10px;">â— ${statusText}</p>`;
                }
            } else {
                html += '<div class="info-message">Opening hours information not available from Google Places.</div>';
            }
            html += '</div>';

            // Photos Section
            html += '<div class="details-section">';
            html += '<h3>ğŸ“· Photos</h3>';
            
            // Check for custom image first
            let hasCustomImage = false;
            if (location && location.customImage) {
                html += '<div class="photos-grid">';
                html += `<div class="photo-item" onclick="window.open('${location.customImage}', '_blank')">`;
                html += `<img src="${location.customImage}" alt="${place.name || location.name} custom photo" loading="lazy">`;
                html += '</div>';
                html += '</div>';
                hasCustomImage = true;
            }
            
            // Add Google Places photos if available
            if (place.photos && place.photos.length > 0) {
                if (!hasCustomImage) {
                    html += '<div class="photos-grid">';
                }
                const photosToShow = place.photos.slice(0, 5); // Show up to 5 photos
                photosToShow.forEach((photo, index) => {
                    const photoUrl = photo.getUrl({ maxWidth: 400, maxHeight: 300 });
                    html += `<div class="photo-item" onclick="window.open('${photoUrl}', '_blank')">`;
                    html += `<img src="${photoUrl}" alt="${place.name} photo ${index + 1}" loading="lazy">`;
                    html += '</div>';
                });
                html += '</div>';
                const photoCount = photosToShow.length + (hasCustomImage ? 1 : 0);
                html += `<p style="color: #666; font-size: 0.85em; margin-top: 10px;">ğŸ“· ${photoCount} photo${photoCount > 1 ? 's' : ''}${hasCustomImage ? ' (including featured image)' : ''}${place.photos.length > 0 ? ' from Google Places' : ''}. Click to view full size.</p>`;
            } else if (!hasCustomImage) {
                html += '<div class="info-message">No photos available from Google Places at this time.</div>';
            } else {
                html += `<p style="color: #666; font-size: 0.85em; margin-top: 10px;">ğŸ“· Featured image shown above. Click to view full size.</p>`;
            }
            html += '</div>';

            // Reviews Section
            html += '<div class="details-section">';
            html += '<h3>â­ Reviews & Ratings</h3>';
            if (place.rating) {
                html += '<div class="reviews-summary">';
                html += '<div class="rating-display">';
                html += '<div class="rating-score">' + place.rating.toFixed(1) + '</div>';
                html += '<div>';
                html += '<div class="rating-stars">' + getStarRating(place.rating) + '</div>';
                if (place.user_ratings_total) {
                    html += `<div class="rating-count">Based on ${place.user_ratings_total.toLocaleString()} reviews</div>`;
                }
                html += '</div></div></div>';
                
                if (place.reviews && place.reviews.length > 0) {
                    html += '<h4 style="margin: 20px 0 15px 0; color: #333;">Recent Reviews:</h4>';
                    const reviewsToShow = place.reviews.slice(0, 3); // Show top 3 reviews
                    reviewsToShow.forEach(review => {
                        html += '<div class="review-item">';
                        html += '<div class="review-header">';
                        html += `<span class="review-author">${review.author_name}</span>`;
                        html += `<span class="review-rating">${getStarRating(review.rating)}</span>`;
                        html += '</div>';
                        html += `<div class="review-text">${review.text}</div>`;
                        if (review.time) {
                            const reviewDate = new Date(review.time * 1000);
                            html += `<div style="color: #999; font-size: 0.85em; margin-top: 8px;">${reviewDate.toLocaleDateString()}</div>`;
                        }
                        html += '</div>';
                    });
                } else {
                    html += '<div class="info-message">Individual reviews not available, but overall rating is shown above.</div>';
                }
            } else {
                html += '<div class="info-message">No rating or review information available from Google Places.</div>';
            }
            html += '</div>';

            // Additional Information
            html += '<div class="details-section">';
            html += '<h3>â„¹ï¸ Additional Information</h3>';
            html += '<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">';
            if (place.business_status) {
                const statusText = place.business_status === 'OPERATIONAL' ? 'Operational' : place.business_status;
                html += `<p style="margin-bottom: 10px;"><strong>Status:</strong> ${statusText}</p>`;
            }
            if (place.types && place.types.length > 0) {
                const relevantTypes = place.types.filter(t => !t.includes('_')).slice(0, 5);
                if (relevantTypes.length > 0) {
                    html += `<p style="margin-bottom: 10px;"><strong>Categories:</strong> ${relevantTypes.map(t => t.replace(/_/g, ' ')).join(', ')}</p>`;
                }
            }
            html += `<p><strong>From Our Guide:</strong> ${location.description}</p>`;
            html += '</div></div>';

            html += '<div style="text-align: center; padding: 20px; color: #999; font-size: 0.85em;">';
            html += 'âœ“ All information sourced from Google Places API<br>';
            html += 'Last updated: ' + new Date().toLocaleDateString();
            html += '</div>';

            modalBody.innerHTML = html;
        }

        function getStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += 'â˜…';
            }
            if (hasHalfStar) {
                stars += 'â˜†';
            }
            const emptyStars = 5 - Math.ceil(rating);
            for (let i = 0; i < emptyStars; i++) {
                stars += 'â˜†';
            }
            
            return stars;
        }

        function showBasicInformation(location, warningMessage = null) {
            console.log('Showing basic information for:', location.name);
            
            // Clear the global timeout
            if (window.currentDetailsTimeout) {
                clearTimeout(window.currentDetailsTimeout);
                window.currentDetailsTimeout = null;
            }
            
            const modalBody = document.getElementById('modalBody');
            let html = '';
            
            if (warningMessage) {
                html += `
                    <div class="info-message">
                        <strong>â„¹ï¸ Note</strong>
                        <p>${warningMessage}</p>
                    </div>
                `;
            }
            
            // Full Address Section
            html += '<div class="details-section">';
            html += '<h3>ğŸ“ Address</h3>';
            html += '<div class="address-block">';
            html += `<p><strong>${location.name}</strong></p>`;
            html += `<p>${location.address}</p>`;
            
            // Add Google Maps link
            const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location.name + ' ' + location.address)}`;
            html += `<p style="margin-top: 10px;">ğŸ—ºï¸ <a href="${mapsUrl}" target="_blank" style="color: #667eea;">Search on Google Maps</a></p>`;
            html += '</div></div>';
            
            // Category and Description
            html += '<div class="details-section">';
            html += '<h3>â„¹ï¸ Information</h3>';
            html += '<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">';
            html += `<p style="margin-bottom: 10px;"><strong>Category:</strong> ${location.category.charAt(0).toUpperCase() + location.category.slice(1)}</p>`;
            html += `<p><strong>Description:</strong> ${location.description}</p>`;
            html += '</div></div>';
            
            // Suggested Actions
            html += '<div class="details-section">';
            html += '<h3>ğŸ’¡ Suggested Actions</h3>';
            html += '<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">';
            html += `<p style="margin-bottom: 10px;">â€¢ Search "${location.name}" on Google for opening hours</p>`;
            html += `<p style="margin-bottom: 10px;">â€¢ Check Google Maps for photos and reviews</p>`;
            html += `<p>â€¢ Visit the official website for the most current information</p>`;
            html += '</div></div>';
            
            html += '<div style="text-align: center; padding: 20px; color: #999; font-size: 0.85em;">';
            html += 'Unable to fetch real-time data from Google Places API.<br>';
            html += 'Please search for this location on Google Maps for the latest information.';
            html += '</div>';
            
            modalBody.innerHTML = html;
        }

        function showDetailsError(message) {
            console.log('Showing error:', message);
            
            // Use showBasicInformation with error message
            if (currentLocationForDetails) {
                showBasicInformation(currentLocationForDetails, message);
            } else {
                // Clear the global timeout
                if (window.currentDetailsTimeout) {
                    clearTimeout(window.currentDetailsTimeout);
                    window.currentDetailsTimeout = null;
                }
                
                const modalBody = document.getElementById('modalBody');
                modalBody.innerHTML = `
                    <div class="error-message">
                        <strong>âš ï¸ Unable to Load Details</strong>
                        <p>${message}</p>
                    </div>
                `;
            }
        }

        // Make locations available globally
        window.locations = locations;
        window.shenzhenLocations = shenzhenLocations;


        // Make initMaps globally accessible
        window.initMaps = initMaps;
        
        // Fallback if API key is not set - use OpenStreetMap instead
        if (typeof google === 'undefined' || !google.maps) {
            console.warn('Google Maps API not loaded. Please add your API key or the map will not display.');
            const mapElement = document.getElementById('shenzhenMap');
            if (mapElement) {
                mapElement.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#666;"><div style="text-align:center;"><p style="font-size:1.2em;margin-bottom:10px;">âš ï¸ Google Maps API Key Required</p><p>Please replace YOUR_API_KEY in the script tag with your actual Google Maps API key.</p><p style="margin-top:10px;font-size:0.9em;">Get your API key at: <a href="https://console.cloud.google.com/google/maps-apis" target="_blank">Google Cloud Console</a></p></div></div>';
            }
        }
    </script>
</body>
</html>